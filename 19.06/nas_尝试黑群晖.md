# 尝试黑群晖
`nas`简单讲就是文件服务器，类似于ftp，不过比ftp功能更强大，其包括了ftp、sftp、nfs、smb等等文件协议，同时有良好的接入界面，以及各种扩展功能。群晖是做nas最有名的一个公司，其产品主要是nas服务器硬件，以及配套的nas系统和软件套件。

在非群晖机器上安装群晖nas系统，就称为黑群晖。家里刚好有台很多年前的笔记本电脑，可以拿来玩一下。
# 1 安装群晖系统
## 1.1 下载系统资源
用到的系统资源为ds3617，[下载链接](https://777.obs.cn-north-1.myhuaweicloud.com/%E7%BE%A4%E6%99%96%E4%BA%8C%E5%90%88%E4%B8%80%E5%AE%8C%E7%BE%8E%E6%B4%97%E7%99%BD.7z)，解压出来，后面只用到系统镜像文件（14G左右）和写盘小工具（猫咪logo)。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas4.jpg)

## 1.2 制作微pe工具
装系统前，需要制作u盘工具，制作方式非常简单，百度搜索微pe，下载。  
![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas1.jpg)  
准备个32G的U盘，双击安装，选择安装到U盘，选择自己的U盘，直接下一步，等待制作完成。   
![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas2.png)  
制作完成后，U盘会被分为两个盘，一个EFI盘装的是wepe系统，另一个空的可以当普通U盘用，这里将第一步中的系统镜像和写盘工具放到这个空的盘中。
## 1.3 开始安装
将U盘插入电脑，开机进入bios（不同电脑进入bios的按键不同），选择用这个U盘启动，进入wepe系统。双击打开桌面的磁盘分区工具，将`电脑的盘符`删除分区，并保存更改。因为要装系统所以把原来的东西删掉。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas3.jpg)

打开U盘，双击写盘工具，选择镜像为14G的镜像文件，然后写入的盘符为刚才删除分区的电脑盘符，点击开始。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas5.jpg)

写入完成后，插好网线，重启，然后拔掉U盘，即可进入群晖系统，看到booting the kenal字样就是成功了。
![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas6.jpg)
## 1.4 初始化群晖系统
安装完成需要进行初始化，同一局域网内找台电脑，浏览器输入`http://find.synology.com/`就可以自动搜索，搜索到设备后，按照说明进行一些账号配置，(`！！注意跳过QuickConnect的配置，因为黑群晖没有群晖账号，这个配置需要账号支持。`)就可以完成初始化了。

如果上述网址加载太慢，也可以直接查看路由器中nas机器的IP地址，在浏览器输入 `http://IP:5000`，效果一样。

初始化完成后，即可进入系统页面。  

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas7.jpg)

这个系统镜像默认只有9G的存储空间，而我的电脑有150G，需要先将原来的空间都删了，在左上角开始菜单选择存储空间管理员，然后在RAID GROUP和存储空间中分别删除，然后分别新增，新增的存储空间类型为Basic，btrfs。这里是为了充分利用这一块硬盘的空间。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas8.png)

# 2 群晖带来的好处
## 2.1 共享文件
在`控制面板`->`共享文件夹`中可以创建文件夹，然后往里上传文件。

在`控制面板`->`文件服务`中，可以开启SMB(默认已开启)/FTP/SFTP/NFS等共享文件服务。其中SMB是windows下的共享文件夹的协议，可以在局域网win电脑上输入`\\IP`或`\\机器名`就能访问到这个网络位置，还可以通过映射的方式将文件夹映射到win电脑的一个盘符。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas9.jpg)

不管是文本、图片还是视频都可以迅速打开，播放。复制粘贴速度也很快，这个速度取决于家庭路由是千兆还是百兆，以及Nas和本机的网卡是千兆还是百兆，当然即使百兆也有12MB/s的速度。

另外，`也可以直接指定ut、迅雷、浏览器等下载工具的下载地址为这个共享文件夹，下载剧集很方便`。

除了可以映射到局域网多台电脑，SMB共享文件的形式还可以在家里的智能电视上进行播放。
## 2.2 私有云-非局域网上传、下载、分享
如果上面的共享文件已经让你兴奋不已，那么下面的一些功能会让你更加喜欢上群晖系统。

上面的文件共享只能在局域网内完成，不能再公网、在户外、在公司分享给别人，也不能在这些地方上传和访问。这无疑限制了nas的发挥。

没关系，通过ddns+端口映射就可以实现公网下的访问。这两项都是在路由器上配置即可。以tplink为例，管理页面(192.168.0.1)中，配置下这两项既可以。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas10.jpg)

ddns中可以用tplink自己提供的，只需注册个tp账号，也可以用花生壳提供的，只需注册个花生壳账号。虚拟服务器中，就是配置端口转发的，我们可以配置5000和5001（群晖的http和https）端口即可，指向的IP为nas的IP。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas11.jpg)

ddns和端口映射的工作方式，我之后会专门写一写，这里不展开讲了，如果不是TP的路由器可以自己百度咋配置ddns和端口映射。

配置完成后，就可以通过`http://ddns域名:5000`或者`https://ddns域名:5001`访问到nas了。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas12.jpg)

此时，就可以在公网下访问页面，上传文件，共享文件了，创建的共享连接是该域名开头的所以互联网下所有人可以下载。

![image](https://bolg.obs.cn-north-1.myhuaweicloud.com/1906/nas1.gif)

## 2.3 强大的套件
群晖系统默认安装了`file station套件`，在套件中心还可以下载其他套件。不过我的黑群晖在下载官方的其他套件的时候提示安装失败。不过没啥影响，最有用的就是这个`file station`了。手机上也可以搜索`DS file`下载，然后输入上面的ddns域名，账密就可以登录查看、下载、分享、上传文件了，还可以进行相册备份，节省手机空间。

在控件面板最后一项终端机，打开ssh，这就是个linux系统，尽情玩耍就行了。

官方其他套件安装不上，但是套件中心的第三方的套件基本都可以安装成功。例如我就安装了apache2.2、php5、webstation、mysql10、phpmyadmin、wordpress、java8、nodejs8、docker、git。
# 3 小结
黑群晖比我想象中功能要强大很多，在安装和探索过程中获得了不少乐趣。

也要提醒几点，一个是用ddns的http 5000端口登录有被盗号的风险，建议用5001的https进行操作。

(当然这里没有证书，会有报错提示，而不想看到报错信息可以申请免费的https证书，然而不幸的是动态域名不能申请证书。可以使用自己的域名在阿里云申请免费证书，然后将域名配置cname指向ddns域名)

第二，群晖系统最好在路由器或者在系统内配置为静态IP，便于使用。

第三，国内运营商默认无法访问80/443/8080/8443等端口，在端口映射的时候，外部端口最好避免这几个。

第四，黑群晖类似于黑苹果系统，不受官方保护，不要开启更新，不要尝试升级。有钱的话，最好还是买官方正版机器和系统。